// Code generated by eddwise, DO NOT EDIT.

package chat

import (
	"errors"

	"github.com/exelr/eddwise"
)

var _ eddwise.ImplChannel = (*Chat)(nil)
var _ ChatRecv = (*Chat)(nil)

type ChatRecv interface {
	OnChangeName(eddwise.Context, *ChangeName) error
	OnMessage(eddwise.Context, *Message) error
}

type Chat struct {
	server eddwise.Server
	recv   ChatRecv
}

func (ch *Chat) Name() string {
	return "chat"
}

func (ch *Chat) Alias() string {
	return "chat"
}

func (ch *Chat) Bind(server eddwise.Server) error {
	ch.server = server
	return nil
}

func (ch *Chat) SetReceiver(chr eddwise.ImplChannel) error {
	if _, ok := chr.(ChatRecv); !ok {
		return errors.New("unexpected channel type while SetReceiver on 'Chat' channel")
	}
	ch.recv = chr.(ChatRecv)
	return nil
}

func (ch *Chat) GetServer() eddwise.Server {
	return ch.server
}

func (ch *Chat) Route(ctx eddwise.Context, evt *eddwise.EventMessage) error {
	switch evt.Name {
	default:
		return eddwise.ErrMissingServerHandler(evt.Channel, evt.Name)

	// change_name
	case "change_name":
		var msg = &ChangeName{}
		if err := ch.server.Codec().Decode(evt.Body, msg); err != nil {
			return err
		}
		if err := msg.CheckReceivedFields(); err != nil {
			return err
		}
		return ch.recv.OnChangeName(ctx, msg)
	// message
	case "message":
		var msg = &Message{}
		if err := ch.server.Codec().Decode(evt.Body, msg); err != nil {
			return err
		}
		if err := msg.CheckReceivedFields(); err != nil {
			return err
		}
		return ch.recv.OnMessage(ctx, msg)
	}
}

func (ch *Chat) OnChangeName(eddwise.Context, *ChangeName) error {
	return errors.New("event 'ChangeName' is not handled on server")
}

func (ch *Chat) OnMessage(eddwise.Context, *Message) error {
	return errors.New("event 'Message' is not handled on server")
}

func (ch *Chat) SendChangeName(client eddwise.Client, msg *ChangeName) error {
	return client.Send(ch.Alias(), msg)
}

func (ch *Chat) SendMessage(client eddwise.Client, msg *Message) error {
	return client.Send(ch.Alias(), msg)
}

func (ch *Chat) SendUserEnter(client eddwise.Client, msg *UserEnter) error {
	return client.Send(ch.Alias(), msg)
}

func (ch *Chat) SendUserLeft(client eddwise.Client, msg *UserLeft) error {
	return client.Send(ch.Alias(), msg)
}

func (ch *Chat) SendUserListUpdate(client eddwise.Client, msg *UserListUpdate) error {
	return client.Send(ch.Alias(), msg)
}

func (ch *Chat) BroadcastChangeName(clients []eddwise.Client, msg *ChangeName) error {
	return eddwise.Broadcast(ch.Alias(), msg, clients)
}

func (ch *Chat) BroadcastMessage(clients []eddwise.Client, msg *Message) error {
	return eddwise.Broadcast(ch.Alias(), msg, clients)
}

func (ch *Chat) BroadcastUserEnter(clients []eddwise.Client, msg *UserEnter) error {
	return eddwise.Broadcast(ch.Alias(), msg, clients)
}

func (ch *Chat) BroadcastUserLeft(clients []eddwise.Client, msg *UserLeft) error {
	return eddwise.Broadcast(ch.Alias(), msg, clients)
}

func (ch *Chat) BroadcastUserListUpdate(clients []eddwise.Client, msg *UserListUpdate) error {
	return eddwise.Broadcast(ch.Alias(), msg, clients)
}

// Event structures

type ChangeName struct {
	// the optional UserId is set only by server while broadcasting
	UserId *uint64 `json:"user_id,omitempty"` // ServerToClient
	Name   string  `json:"name"`
}

func (evt *ChangeName) GetEventName() string {
	return "change_name"
}

func (evt *ChangeName) ProtocolAlias() string {
	return "change_name"
}

func (evt *ChangeName) CheckSendFields() error {
	return nil
}

func (evt *ChangeName) CheckReceivedFields() error {
	if evt.UserId != nil {
		return errors.New("ChangeName.UserId is an invalid field")
	}
	return nil
}
func (evt *ChangeName) SetUserId(user_id uint64) *ChangeName {
	evt.UserId = &user_id
	return evt
}

type Message struct {
	// UserId is the optional id of the user. Set only by server, not by client
	UserId *uint64 `json:"user_id,omitempty"` // ServerToClient
	Text   string  `json:"text"`
}

func (evt *Message) GetEventName() string {
	return "message"
}

func (evt *Message) ProtocolAlias() string {
	return "message"
}

func (evt *Message) CheckSendFields() error {
	return nil
}

func (evt *Message) CheckReceivedFields() error {
	if evt.UserId != nil {
		return errors.New("Message.UserId is an invalid field")
	}
	return nil
}
func (evt *Message) SetUserId(user_id uint64) *Message {
	evt.UserId = &user_id
	return evt
}

type UserEnter struct {
	UserId uint64 `json:"user_id"`
	Name   string `json:"name"`
}

func (evt *UserEnter) GetEventName() string {
	return "user_enter"
}

func (evt *UserEnter) ProtocolAlias() string {
	return "user_enter"
}

func (evt *UserEnter) CheckSendFields() error {
	return nil
}

func (evt *UserEnter) CheckReceivedFields() error {
	return nil
}

type UserLeft struct {
	UserId uint64 `json:"user_id"`
}

func (evt *UserLeft) GetEventName() string {
	return "user_left"
}

func (evt *UserLeft) ProtocolAlias() string {
	return "user_left"
}

func (evt *UserLeft) CheckSendFields() error {
	return nil
}

func (evt *UserLeft) CheckReceivedFields() error {
	return nil
}

type UserListUpdate struct {
	List map[string]string `json:"list"`
}

func (evt *UserListUpdate) GetEventName() string {
	return "user_list_update"
}

func (evt *UserListUpdate) ProtocolAlias() string {
	return "user_list_update"
}

func (evt *UserListUpdate) CheckSendFields() error {
	return nil
}

func (evt *UserListUpdate) CheckReceivedFields() error {
	return nil
}
